<!DOCTYPE html>
<html lang="de" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ValueRadar Pro - Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        teal: { 400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488', 900: '#134e4a' },
                        slate: { 800: '#1e293b', 900: '#0f172a', 950: '#020617' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0b0f19;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #334155;
        }

        .glass-card {
            background: rgba(17, 24, 39, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .glass-header {
            background: rgba(11, 15, 25, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .bg-grid-pattern {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }

        .wl-item.active {
            background: rgba(20, 184, 166, 0.05);
            border-left: 3px solid #14b8a6;
        }

        .chart-btn.active {
            background: #0d9488;
            color: white;
        }

        /* Range Bar Styling */
        .range-bar-bg {
            background: #334155;
            height: 6px;
            border-radius: 3px;
            position: relative;
            width: 100%;
            margin-top: 8px;
        }

        .range-bar-fill {
            background: #cbd5e1;
            height: 100%;
            border-radius: 3px;
            position: absolute;
            left: 0;
        }

        .range-marker {
            width: 10px;
            height: 10px;
            background: #2dd4bf;
            border: 2px solid #0f172a;
            border-radius: 50%;
            position: absolute;
            top: -2px;
            transform: translateX(-50%);
            z-index: 10;
        }

        .text-justify-clamped {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .text-expanded {
            -webkit-line-clamp: unset;
        }
    </style>
</head>

<body class="h-screen flex overflow-hidden selection:bg-teal-500/30 selection:text-white">

    <div class="fixed inset-0 bg-grid-pattern pointer-events-none z-0"></div>

    <aside class="w-72 border-r border-slate-800/50 bg-[#080b14] flex flex-col z-20 relative h-full shrink-0">
        <div class="h-16 flex items-center px-6 gap-3 shrink-0 border-b border-white/5">
            <div class="bg-teal-600 text-white font-bold px-2 py-0.5 rounded text-xs shadow-lg shadow-teal-900/50">VR
            </div>
            <span class="font-bold text-lg tracking-tight text-white">ValueRadar <span
                    class="text-teal-500 text-xs">PRO</span></span>
        </div>

        <div class="px-4 pt-4 shrink-0">
            <input type="text" id="watchlist-search" onkeyup="filterStocksByName(this.value)"
                placeholder="Search Ticker..."
                class="w-full bg-[#111621] text-xs rounded border border-slate-800 px-3 py-2 text-slate-300 focus:outline-none focus:border-teal-600 transition mb-3">

            <div class="flex bg-[#111621] rounded-lg p-1 border border-slate-800 w-full justify-between">
                <button onclick="filterStocks('ALL')"
                    class="region-btn flex-1 py-1 text-[10px] font-bold rounded text-slate-400 active-region"
                    data-reg="ALL">ALL</button>
                <button onclick="filterStocks('US')" class="region-btn flex-1 py-1 text-[10px] font-bold text-slate-400"
                    data-reg="US">US</button>
                <button onclick="filterStocks('DE')" class="region-btn flex-1 py-1 text-[10px] font-bold text-slate-400"
                    data-reg="DE">DE</button>
                <button onclick="filterStocks('FAV')"
                    class="region-btn flex-1 py-1 text-[10px] font-bold text-slate-400" data-reg="FAV">★</button>
            </div>
        </div>

        <div id="watchlist-container" class="flex-1 overflow-y-auto mt-2 pb-4">
        </div>

        <div class="p-4 border-t border-slate-800 shrink-0 bg-[#080b14]">
            <button onclick="addSymbolToWatchlist()"
                class="w-full py-2 border border-dashed border-slate-700 text-slate-500 hover:text-white hover:border-slate-500 rounded text-xs transition">+
                Symbol</button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative overflow-hidden z-10 w-full h-full bg-[#0b0f19]">

        <header class="h-16 glass-header flex items-center justify-between px-6 sticky top-0 z-30 shrink-0">
            <div class="min-w-0 flex items-center gap-4">
                <div>
                    <h1 class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                        <span id="header-name">ValueRadar</span>
                        <span id="header-ticker"
                            class="text-xs font-mono text-slate-400 bg-slate-800 px-1.5 py-0.5 rounded">--</span>
                    </h1>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="text-right">
                    <div id="header-price" class="text-xl font-bold text-white font-mono">--</div>
                    <div class="text-[10px] text-teal-400 animate-pulse">● Live</div>
                </div>

                <button onclick="toggleLang()"
                    class="text-xs font-bold text-slate-400 hover:text-white border border-slate-700 px-2 py-1 rounded bg-slate-800">
                    <span id="lang-btn-text">EN</span>
                </button>

                <a href="/logout" class="text-slate-400 hover:text-red-400 p-2" title="Logout">
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                </a>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 lg:p-6 scroll-smooth pb-20">
            <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">

                <section class="lg:col-span-12 glass-card rounded-xl p-5">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-sm font-bold text-slate-300 uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="activity" class="w-4 h-4 text-teal-500"></i> <span
                                data-t="chart_title">Price Action</span>
                        </h2>
                        <div class="flex bg-slate-800/50 rounded p-0.5 border border-white/5">
                            <button onclick="updateTimeframe('1M')" data-tf="1M" class="tf-btn chart-btn">1M</button>
                            <button onclick="updateTimeframe('6M')" data-tf="6M" class="tf-btn chart-btn">6M</button>
                            <button onclick="updateTimeframe('1Y')" data-tf="1Y"
                                class="tf-btn chart-btn active">1Y</button>
                            <button onclick="updateTimeframe('5Y')" data-tf="5Y" class="tf-btn chart-btn">5Y</button>
                        </div>
                    </div>

                    <div id="chart" class="h-[350px] w-full"></div>

                    <div class="mt-4 border-t border-slate-800 pt-4">
                        <h3 class="text-xs font-bold text-slate-400 mb-1" data-t="desc_title">About</h3>
                        <p id="company-desc"
                            class="text-xs text-slate-400 leading-relaxed text-justify-clamped transition-all">
                            Loading description...
                        </p>
                        <button onclick="toggleDesc()" id="read-more-btn"
                            class="text-[10px] text-teal-500 mt-1 hover:underline">Read more</button>
                    </div>
                </section>

                <section class="lg:col-span-4 space-y-4">

                    <div class="glass-card rounded-lg p-4 flex flex-col justify-center">
                        <div class="flex justify-between items-end mb-2">
                            <div>
                                <div class="text-[10px] text-slate-500 uppercase font-bold" data-t="mcap">Market Cap
                                </div>
                                <div id="val-mcap" class="text-lg font-bold text-white">--</div>
                            </div>
                            <div class="text-xs text-slate-400" id="mcap-context">Volatile</div>
                        </div>
                        <div class="h-1 bg-slate-800 rounded overflow-hidden">
                            <div class="h-full bg-teal-600 w-full opacity-50"></div>
                        </div>
                    </div>

                    <div class="glass-card rounded-lg p-4">
                        <div class="flex justify-between items-end mb-1">
                            <div>
                                <div class="text-[10px] text-slate-500 uppercase font-bold" data-t="pe">P/E Ratio (KGV)
                                </div>
                                <div id="val-pe" class="text-lg font-bold text-white">--</div>
                            </div>
                            <span id="badge-pe"
                                class="text-[9px] px-2 py-0.5 rounded bg-slate-800 text-slate-400">--</span>
                        </div>
                        <div class="mt-2">
                            <div class="flex justify-between text-[9px] text-slate-600 mb-0.5">
                                <span>Cheap (< 15)</span>
                                        <span>Exp (> 30)</span>
                            </div>
                            <div class="relative h-2 bg-slate-800 rounded-full w-full">
                                <div id="pe-marker"
                                    class="absolute w-3 h-3 bg-teal-500 rounded-full border-2 border-[#0b0f19] top-[-2px] transition-all duration-1000"
                                    style="left: 0%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-lg p-4">
                        <div class="flex justify-between items-end mb-1">
                            <div>
                                <div class="text-[10px] text-slate-500 uppercase font-bold" data-t="range">52W Range
                                </div>
                                <div class="text-lg font-bold text-white" id="val-curr-price">--</div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <div class="flex justify-between text-[9px] text-slate-600 mb-0.5">
                                <span id="val-low">Low</span>
                                <span id="val-high">High</span>
                            </div>
                            <div class="relative h-2 bg-slate-800 rounded-full w-full">
                                <div id="range-marker"
                                    class="absolute w-3 h-3 bg-white rounded-full border-2 border-[#0b0f19] top-[-2px] transition-all duration-1000"
                                    style="left: 50%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card rounded-lg p-4 flex items-center justify-between">
                        <div>
                            <div class="text-[10px] text-slate-500 uppercase font-bold" data-t="growth">Rev. Growth
                            </div>
                            <div id="val-growth" class="text-lg font-bold text-white">--</div>
                        </div>
                        <div id="growth-icon" class="p-2 bg-slate-800 rounded-full text-slate-500">
                            <i data-lucide="minus" class="w-5 h-5"></i>
                        </div>
                    </div>

                </section>

                <section class="lg:col-span-8 flex flex-col gap-6">

                    <div class="glass-card rounded-xl p-5 flex-1">
                        <h3
                            class="text-sm font-bold text-slate-300 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <i data-lucide="newspaper" class="w-4 h-4 text-teal-500"></i> <span
                                data-t="news_title">Latest News</span>
                        </h3>
                        <div id="news-container" class="space-y-3 overflow-y-auto max-h-[300px] pr-2 scroll-thin">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                        <div
                            class="glass-card rounded-xl p-5 flex flex-col items-center justify-center relative min-h-[200px]">
                            <div class="text-[10px] text-slate-400 font-bold uppercase tracking-widest absolute top-4 left-4"
                                data-t="sentiment">VR Sentiment</div>
                            <div id="gauge-chart" class="w-full h-40 mt-4"></div>
                            <div class="mt-[-20px] text-center">
                                <div id="sentiment-text" class="text-teal-400 font-bold text-lg">--</div>
                            </div>
                        </div>

                        <div class="glass-card rounded-xl p-5 overflow-y-auto max-h-[200px]">
                            <div class="flex gap-4 mb-3 border-b border-slate-700 pb-2">
                                <button onclick="showTab('pros')" id="tab-pros"
                                    class="text-xs font-bold text-green-400 border-b-2 border-green-400 pb-1">Pros</button>
                                <button onclick="showTab('cons')" id="tab-cons"
                                    class="text-xs font-bold text-slate-500 pb-1">Risks</button>
                            </div>
                            <ul id="pros-list" class="space-y-2 block"></ul>
                            <ul id="cons-list" class="space-y-2 hidden"></ul>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();

        /* ---------- CONFIG & STATE ---------- */
        let currentLang = 'en';
        let currentSymbol = '';
        let fullList = [];
        let chart = null;
        let gaugeChart = null;
        let abortController = new AbortController();

        const translations = {
            en: {
                chart_title: "Price Action",
                desc_title: "About",
                mcap: "Market Cap",
                pe: "P/E Ratio",
                range: "52W Range",
                growth: "Rev. Growth",
                news_title: "Latest News",
                sentiment: "VR Sentiment",
                read_more: "Read more",
                read_less: "Read less"
            },
            de: {
                chart_title: "Kursverlauf",
                desc_title: "Über das Unternehmen",
                mcap: "Marktkapitalisierung",
                pe: "KGV",
                range: "52-Wochen Spanne",
                growth: "Umsatzwachstum",
                news_title: "Aktuelle Nachrichten",
                sentiment: "VR Stimmung",
                read_more: "Mehr anzeigen",
                read_less: "Weniger anzeigen"
            }
        };

        /* ---------- INIT ---------- */
        fetch('/api/stocks').then(r => r.json()).then(d => {
            fullList = d;
            filterStocks('ALL');
        });

        /* ---------- LANGUAGE LOGIC ---------- */
        function toggleLang() {
            currentLang = currentLang === 'en' ? 'de' : 'en';
            document.getElementById('lang-btn-text').innerText = currentLang.toUpperCase();

            // Update static labels
            const t = translations[currentLang];
            document.querySelectorAll('[data-t]').forEach(el => {
                const key = el.dataset.t;
                if (t[key]) el.innerText = t[key];
            });

            // Re-render dynamic content if needed
            if (currentSymbol) loadDetails(currentSymbol);
        }

        /* ---------- UI LOGIC ---------- */
        function toggleDesc() {
            const el = document.getElementById('company-desc');
            const btn = document.getElementById('read-more-btn');
            el.classList.toggle('text-justify-clamped');
            el.classList.toggle('text-expanded');
            btn.innerText = el.classList.contains('text-expanded') ? translations[currentLang].read_less : translations[currentLang].read_more;
        }

        function showTab(type) {
            document.getElementById('pros-list').classList.toggle('hidden', type !== 'pros');
            document.getElementById('cons-list').classList.toggle('hidden', type !== 'cons');

            document.getElementById('tab-pros').className = type === 'pros' ? "text-xs font-bold text-green-400 border-b-2 border-green-400 pb-1" : "text-xs font-bold text-slate-500 pb-1";
            document.getElementById('tab-cons').className = type === 'cons' ? "text-xs font-bold text-red-400 border-b-2 border-red-400 pb-1" : "text-xs font-bold text-slate-500 pb-1";
        }

        /* ---------- WATCHLIST LOGIC (Simplified) ---------- */
        function filterStocks(reg) {
            // ... (Hier deine Filterlogik aus dem alten Code rein, der Übersichtlichkeit halber gekürzt) ...
            // Ich nehme an, du kopierst die filterStocks/renderStockList Logik, 
            // wichtig ist nur, dass beim Klick selectStock(symbol) aufgerufen wird.

            // Dummy implementation for demo:
            const container = document.getElementById('watchlist-container');
            container.innerHTML = '';

            // Filter list based on Region
            let list = fullList;
            if (reg !== 'ALL' && reg !== 'FAV') list = fullList.filter(s => (s.Region || 'US') === reg);

            if (list.length === 0) list = fullList; // Fallback

            list.forEach(s => {
                const div = document.createElement('div');
                div.className = "wl-item px-5 py-3 cursor-pointer hover:bg-white/5 border-b border-white/5";
                div.onclick = () => selectStock(s.Symbol || s.symbol);
                div.innerHTML = `
                    <div class="flex justify-between text-xs text-slate-200 font-bold">
                        <span>${s.Symbol || s.symbol}</span>
                        <span>$${parseFloat(s.Price || 0).toFixed(2)}</span>
                    </div>
                    <div class="text-[10px] text-slate-500 truncate">${s.Name || s.name}</div>
                `;
                container.appendChild(div);
            });

            if (!currentSymbol && list.length > 0) selectStock(list[0].Symbol || list[0].symbol);

            // Update Tabs
            document.querySelectorAll('.region-btn').forEach(b => {
                b.className = "region-btn flex-1 py-1 text-[10px] font-bold text-slate-400 transition";
                if (b.dataset.reg === reg) b.className = "region-btn flex-1 py-1 text-[10px] font-bold bg-teal-600 text-white rounded shadow-sm transition";
            });
        }

        function filterStocksByName(val) {
            // Gleiche Logik wie vorher
        }

        async function addSymbolToWatchlist() {
            let sym = prompt("Ticker Symbol (e.g. AAPL):");
            if (sym) {
                await fetch(`/api/details/${sym}`); // Validate
                location.reload(); // Quick refresh to add
            }
        }

        /* ---------- DETAILS & VISUALS ---------- */
        function selectStock(sym) {
            currentSymbol = sym;
            document.getElementById('header-ticker').innerText = sym;
            loadDetails(sym);
            updateChart('1Y');
        }

        async function loadDetails(sym) {
            try {
                const r = await fetch(`/api/details/${sym}`);
                const d = await r.json();

                // Header
                document.getElementById('header-name').innerText = d.name;
                document.getElementById('header-price').innerText = "$" + d.price_now.toFixed(2);
                document.getElementById('val-curr-price').innerText = "$" + d.price_now.toFixed(2);

                // Description
                document.getElementById('company-desc').innerText = d.description || "No description available.";

                // 1. Market Cap
                document.getElementById('val-mcap').innerText = formatNum(d.market_cap);

                // 2. KGV Range Bar
                // Range 0 to 40 (cap at 40 for visuals)
                let pe = d.pe || 0;
                document.getElementById('val-pe').innerText = pe.toFixed(1);

                let pePercent = (pe / 40) * 100;
                if (pePercent > 100) pePercent = 100;
                if (pePercent < 0) pePercent = 0;
                document.getElementById('pe-marker').style.left = pePercent + "%";

                let badge = document.getElementById('badge-pe');
                if (pe < 15) { badge.innerText = "CHEAP"; badge.className = "text-[9px] px-2 py-0.5 rounded bg-teal-500/20 text-teal-400"; }
                else if (pe > 25) { badge.innerText = "EXPENSIVE"; badge.className = "text-[9px] px-2 py-0.5 rounded bg-red-500/20 text-red-400"; }
                else { badge.innerText = "FAIR"; badge.className = "text-[9px] px-2 py-0.5 rounded bg-slate-700 text-slate-300"; }

                // 3. 52 Week Range Bar
                if (d.year_low && d.year_high) {
                    document.getElementById('val-low').innerText = d.year_low.toFixed(0);
                    document.getElementById('val-high').innerText = d.year_high.toFixed(0);

                    let rangePct = ((d.price_now - d.year_low) / (d.year_high - d.year_low)) * 100;
                    rangePct = Math.max(0, Math.min(100, rangePct)); // Clamp 0-100
                    document.getElementById('range-marker').style.left = rangePct + "%";
                }

                // 4. Growth
                let gr = (d.revenue_growth || 0) * 100;
                document.getElementById('val-growth').innerText = (gr > 0 ? "+" : "") + gr.toFixed(1) + "%";
                document.getElementById('val-growth').className = gr > 0 ? "text-lg font-bold text-white" : "text-lg font-bold text-red-400";

                let iconContainer = document.getElementById('growth-icon');
                if (gr > 5) iconContainer.innerHTML = '<i data-lucide="trending-up" class="w-5 h-5 text-green-400"></i>';
                else if (gr < 0) iconContainer.innerHTML = '<i data-lucide="trending-down" class="w-5 h-5 text-red-400"></i>';
                else iconContainer.innerHTML = '<i data-lucide="minus" class="w-5 h-5 text-slate-500"></i>';
                lucide.createIcons();

                // News
                const newsCont = document.getElementById('news-container');
                newsCont.innerHTML = (d.news || []).map(n => `
                    <a href="${n.link}" target="_blank" class="block bg-slate-800/30 p-3 rounded border border-white/5 hover:border-teal-500/30 transition">
                        <div class="flex justify-between text-[10px] text-slate-500 mb-1">
                            <span class="text-teal-500 font-bold">${n.publisher}</span>
                            <span>${n.date}</span>
                        </div>
                        <div class="text-xs text-slate-300 font-medium">${n.title}</div>
                    </a>
                `).join('');

                // Lists
                const makeList = (items) => (items || []).map(i => `<li class="flex gap-2 text-xs text-slate-400"><span class="text-teal-500">•</span>${i}</li>`).join('');
                document.getElementById('pros-list').innerHTML = makeList(d.pros);
                document.getElementById('cons-list').innerHTML = makeList(d.risks);

                // Sentiment (Fake calc for demo based on PE/Growth)
                let score = 50;
                if (pe < 20) score += 15;
                if (gr > 0) score += 15;
                if (d.perf_1y > 0) score += 10;
                renderGauge(score);
                document.getElementById('sentiment-text').innerText = score > 60 ? "Strong Buy" : (score < 40 ? "Sell" : "Hold");

            } catch (e) { console.error(e); }
        }

        /* ---------- CHART ---------- */
        async function updateTimeframe(tf) {
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.tf-btn[data-tf="${tf}"]`).classList.add('active');

            if (abortController) abortController.abort();
            abortController = new AbortController();

            try {
                const r = await fetch(`/api/history/${currentSymbol}/${tf}`, { signal: abortController.signal });
                const d = await r.json();
                if (d.candle) renderChart(d.candle);
            } catch (e) { }
        }

        function renderChart(data) {
            const seriesData = data.map(x => ({ x: x[0], y: [x[1], x[2], x[3], x[4]] }));

            const options = {
                chart: { type: 'candlestick', height: 350, background: 'transparent', toolbar: { show: false }, animations: { enabled: false } },
                theme: { mode: 'dark' },
                series: [{ data: seriesData }],
                xaxis: { type: 'datetime', labels: { style: { colors: '#64748b' } }, axisBorder: { show: false }, axisTicks: { show: false } },
                yaxis: {
                    opposite: false, // LINKSE ACHSE WIE GEWÜNSCHT
                    labels: { style: { colors: '#64748b' } }
                },
                grid: { borderColor: '#1e293b', padding: { bottom: 20 } }, // MEHR PLATZ UNTEN
                plotOptions: { candlestick: { colors: { upward: '#2dd4bf', downward: '#ef4444' } } }
            };

            if (chart) chart.destroy();
            chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();
        }

        function renderGauge(val) {
            const options = {
                series: [val],
                chart: { type: 'radialBar', height: 200 },
                plotOptions: {
                    radialBar: {
                        hollow: { size: '60%', background: 'transparent' },
                        track: { background: '#1e293b' },
                        dataLabels: { show: true, value: { color: '#fff', fontSize: '24px', offsetY: -10 } }
                    }
                },
                colors: ['#14b8a6'],
                stroke: { lineCap: 'round' }
            };
            if (gaugeChart) gaugeChart.destroy();
            gaugeChart = new ApexCharts(document.querySelector("#gauge-chart"), options);
            gaugeChart.render();
        }

        function formatNum(n) {
            if (!n) return "-";
            if (n >= 1e12) return (n / 1e12).toFixed(1) + "T";
            if (n >= 1e9) return (n / 1e9).toFixed(1) + "B";
            if (n >= 1e6) return (n / 1e6).toFixed(1) + "M";
            return n;
        }
    </script>
</body>

</html>